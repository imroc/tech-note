---
sidebar_position: 50
---

# 使用 docusaurus 构建开源电子书

## 创建电子书

```bash
npx create-docusaurus@latest kubernetes-guide classic --typescript
```

## 安装依赖

```bash npm2yarn
npm install --save docusaurus-plugin-sass sass @giscus/react raw-loader path-browserify flexanalytics/plugin-image-zoom @docusaurus/plugin-ideal-image@latest @docusaurus/plugin-pwa@latest
npm install --save-dev typescript @docusaurus/module-type-aliases @docusaurus/tsconfig @docusaurus/types
```

## 自定义样式

将 `src/css/custom.css` 重命名为 `src/css/custom.scss`，覆盖为以下内容：

<FileBlock showLineNumbers file="@site/src/css/custom.scss" title="src/css/custom.scss" />

## 清理不需要的文件

因为是电子书，不需要默认的首页，也不需要博客页面，直接用电子书作为首页。很多默认生成的文件是不需要的，可以删除：

```bash
rm -rf src/components/HomepageFeatures
rm -rf src/pages/*
rm -rf blog
rm -rf static/img/*
```

## 创建自定义组件

### giscus 评论组件

<FileBlock showLineNumbers file="@site/src/components/Comment.tsx" title="src/components/Comment.tsx" />

### 增强代码块 FileBlock

<FileBlock showLineNumbers file="@site/src/components/FileBlock.tsx" title="src/components/FileBlock.tsx" />

## 添加文档

在 docs 目录下新建文档：

```bash
website # website root directory
├── docs
│   │── intro.md
│   │── hello.md
│   └── tutorial-basics
│       └──create-a-document.md
├── ...
```

## 配置侧边栏

电子书的侧边栏（目录）是通过配置文件 `sidebars.js` 配置的，默认文件路径是项目根目录下的 `./sidebar.js`：

```ts showLineNumbers title="docusaurus.config.js"
export default {
  presets: [
    [
      'classic',
      {
        docs: {
          // highlight-next-line
          sidebarPath: './sidebars.js',
        },
      },
    ],
  ],
};
```

如果希望侧边栏目录根据 `docs`  目录下的文件自动生成，可以使用类似如下的配置：

```ts showLineNumbers title="sidebars.js"
import type {SidebarsConfig} from '@docusaurus/plugin-content-docs';
const sidebars: SidebarsConfig = {
  // highlight-next-line
  tutorialSidebar: [{type: 'autogenerated', dirName: '.'}],
};

export default sidebars;
```

如果希望自定义侧边栏目录，可以使用类似如下的配置：

```ts
import type {SidebarsConfig} from '@docusaurus/plugin-content-docs';
const sidebars: SidebarsConfig = {
  tutorialSidebar: [
    'intro', // 第一个是首页
    'hello',
    { // 目录
      type: 'category',
      label: 'Tutorial',
      items: [
        'tutorial-basics/create-a-document'
      ],
    },
  ],
};

export default sidebars;
```

## 国际化

当电子书需要支持多语言时，先配置下 i18n，并加上切换语言的下拉框：

```ts showLineNumbers
export default {
  i18n: {
    defaultLocale: 'zh',
    // highlight-add-start
    locales: ['zh', 'en'],
    localeConfigs: {
      zh: {
        label: '中文',
        htmlLang: 'zh-CN',
      },
      en: {
        label: 'English',
        htmlLang: 'en-US',
      },
    }
    // highlight-add-end
  },
  themeConfig: {
    navbar: {
      items: [
        // ...
        // highlight-add-start
        {
          type: 'localeDropdown', // 语言选择下拉框
          position: 'right', // 放在右上方
        },
        // highlight-add-end
        // ...
      ],
    },
  },
  // ...
};
```

然后初始化 i18n 目录：

```bash
npm run write-translations -- --locale en
```

将未翻译的 markdown 文件复制到目标语言目录下：

```bash
mkdir -p i18n/en/docusaurus-plugin-content-docs/current
cp -r docs/** i18n/en/docusaurus-plugin-content-docs/current
```

然后将内容原地翻译成目标语言（可利用 AI 进行翻译），翻译完成后最终构建出来的电子书就支持国际化了，可点击语言选择下拉框来切换语言。

预览不支持多语言切换，需显式指定 locale：

```bash
npm run start -- --locale en
```

## 参考资料

- [Docusaurus 文档](https://docusaurus.io/zh-CN/docs/docs-introduction)
- [i18n - 教程](https://docusaurus.io/zh-CN/docs/i18n/tutorial)
